var Multicorder=function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=t(e);function n(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function i(e){return function(){var t=this,r=arguments;return new Promise((function(i,o){var a=e.apply(t,r);function s(e){n(a,i,o,s,c,"next",e)}function c(e){n(a,i,o,s,c,"throw",e)}s(void 0)}))}}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null==r)return;var n,i,o=[],a=!0,s=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(o.push(n.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==r.return||r.return()}finally{if(s)throw i}}return o}(e,t)||s(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||s(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){if(e){if("string"==typeof e)return c(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}for(var u=function(){return r.default.randomBytes(16)},d=[],l=0;l<256;++l)d[l]=(l+256).toString(16).substr(1);var h,f,v=function(e,t){var r=t||0,n=d;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")},p=0,m=0;var g=function(e,t,r){var n=t&&r||0,i=t||[],o=(e=e||{}).node||h,a=void 0!==e.clockseq?e.clockseq:f;if(null==o||null==a){var s=u();null==o&&(o=h=[1|s[0],s[1],s[2],s[3],s[4],s[5]]),null==a&&(a=f=16383&(s[6]<<8|s[7]))}var c=void 0!==e.msecs?e.msecs:(new Date).getTime(),d=void 0!==e.nsecs?e.nsecs:m+1,l=c-p+(d-m)/1e4;if(l<0&&void 0===e.clockseq&&(a=a+1&16383),(l<0||c>p)&&void 0===e.nsecs&&(d=0),d>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=c,m=d,f=a;var g=(1e4*(268435455&(c+=122192928e5))+d)%4294967296;i[n++]=g>>>24&255,i[n++]=g>>>16&255,i[n++]=g>>>8&255,i[n++]=255&g;var y=c/4294967296*1e4&268435455;i[n++]=y>>>8&255,i[n++]=255&y,i[n++]=y>>>24&15|16,i[n++]=y>>>16&255,i[n++]=a>>>8|128,i[n++]=255&a;for(var w=0;w<6;++w)i[n+w]=o[w];return t||v(i)};var y=function(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||u)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var o=0;o<16;++o)t[n+o]=i[o];return t||v(i)},w=y;w.v1=g,w.v4=y;var b=w;function S(e,t,r,n,i,o,a,s,c,u){"boolean"!=typeof a&&(c=s,s=a,a=!1);const d="function"==typeof r?r.options:r;let l;if(e&&e.render&&(d.render=e.render,d.staticRenderFns=e.staticRenderFns,d._compiled=!0,i&&(d.functional=!0)),n&&(d._scopeId=n),o?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,c(e)),e&&e._registeredComponents&&e._registeredComponents.add(o)},d._ssrRegister=l):t&&(l=a?function(e){t.call(this,u(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,s(e))}),l)if(d.functional){const e=d.render;d.render=function(t,r){return l.call(r),e(t,r)}}else{const e=d.beforeCreate;d.beforeCreate=e?[].concat(e,l):[l]}return r}var $=S({render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"multicorder"},[r("video",{directives:[{name:"show",rawName:"v-show",value:"video"==e.view,expression:"view == 'video'"}],ref:"video",attrs:{width:e.width,height:e.height,src:e.source,autoplay:e.autoplay,playsinline:e.playsinline,muted:"muted"},domProps:{muted:!0}}),e._v(" "),r("img",{directives:[{name:"show",rawName:"v-show",value:"snapshot"==e.view,expression:"view == 'snapshot'"}],attrs:{src:e.snapshot,width:"100%",height:"100%"}}),e._v(" "),r("video",{directives:[{name:"show",rawName:"v-show",value:"videoPlayer"==e.view,expression:"view == 'videoPlayer'"}],ref:"videoPlayer",attrs:{width:e.width,height:e.height,src:e.playerSource,playsinline:e.playsinline}})])},staticRenderFns:[]},undefined,{name:"Multicorder",data:function(){return{source:null,playerSource:null,canvas:null,snapshot:null,snapshotSource:null,cameras:[],camerasEmitted:null,browserScreenshareSupported:null,recorder:null,recordings:[],view:"video",nowPlaying:null}},props:{videoSource:{type:Object,default:null},width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:"100%"},autoplay:{type:Boolean,default:!0},playsinline:{type:Boolean,default:!0},recorderMuted:{type:Boolean,default:!0},playerMuted:{type:Boolean,default:!0},screenshotFormat:{type:String,default:"image/jpeg"},videoTypes:{type:Array,default:function(){return["camera","screen"]}},recorderMode:{type:String,default:"single"},camerasHeader:{type:Array,default:function(){return[{divider:!0,header:"Cameras"}]}},staticVideoOptions:{type:Array,default:function(){return[{text:"Screen share",value:"screenshare"}]}},staticVideoOptionsHeader:{type:Array,default:function(){return[{divider:!0,header:"Screen Sharing"}]}}},mounted:function(){this.initVideoOptions()},beforeDestroy:function(){this.stopVideo()},watch:{videoSource:function(e){this.changeVideoSource(e)}},methods:{setView:function(e){this.view=e,this.$emit("view-change",e)},changeVideoSource:function(e){this.stopVideo(),this.$emit("video-change",e),e&&("screenshare"==e.value?this.startScreenshare():this.loadCamera(e.value))},loadCamera:function(e){var t=this,r={video:{deviceId:{exact:e}},audio:{echoCancellation:!0}};this.resolution&&(r.video.height=this.resolution.height,r.video.width=this.resolution.width),navigator.mediaDevices.getUserMedia(r).then((function(e){return t.loadSrcStream(e)})).catch((function(e){return t.$emit("error",e)}))},startScreenshare:function(){var e=this;try{navigator.mediaDevices.getDisplayMedia().then((function(t){return e.loadSrcStream(t)}))}catch(e){console.error("Error: "+e)}},loadSrcStream:function(e){var t=this;"srcObject"in this.$refs.video?this.$refs.video.srcObject=e:this.source=window.HTMLMediaElement.srcObject(e),this.$refs.video.onloadedmetadata=function(){t.$emit("video-live",e)},this.$emit("started",e)},initVideoOptions:function(){this.videoTypes.includes("screen")&&this.initScreen(),this.videoTypes.includes("camera")?this.initCameras():(this.$emit("cameras",[]),this.camerasEmitted=!0)},initScreen:function(){this.browserScreenshareSupported=!0},initCameras:function(){void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=this.legacyGetUserMediaSupport()),this.testVideoAccess()},testVideoAccess:function(){var e=this,t={video:!0,audio:{echoCancellation:!0}};this.resolution&&(t.video={},t.video.height=this.resolution.height,t.video.width=this.resolution.width),navigator.mediaDevices.getUserMedia(t).then((function(t){t.getTracks().forEach((function(e){e.stop()})),e.loadCameras()})).catch((function(t){return e.$emit("error",t)}))},legacyGetUserMediaSupport:function(){return function(e){var t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||navigator.oGetUserMedia;return t?new Promise((function(r,n){t.call(navigator,e,r,n)})):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}},loadCameras:function(){var e=this;navigator.mediaDevices.enumerateDevices().then((function(t){for(var r=0;r!==t.length;++r){var n=t[r];"videoinput"===n.kind&&e.cameras.push({text:n.label,value:n.deviceId})}})).then((function(){e.camerasEmitted||(e.$emit("cameras",e.cameras),e.camerasEmitted=!0)})).catch((function(t){return e.$emit("notsupported",t)}))},stopVideo:function(){null!==this.$refs.video&&this.$refs.video.srcObject&&this.stopStreamedVideo(this.$refs.video)},stopStreamedVideo:function(e){var t=this,r=e.srcObject;r.getTracks().forEach((function(e){e.stop(),t.$emit("stoppedVideo",r),t.$refs.video.srcObject=null,t.source=null}))},listFromCameras:function(e){return this.browserScreenshareSupported&&e.length>0?[].concat(a(this.camerasHeader),a(e),a(this.staticVideoOptionsHeader),a(this.staticVideoOptions)):this.browserScreenshareSupported&&0===e.length?this.staticVideoOptions:e},startVideoRecording:function(){var e=this,t=this.$refs.video.srcObject,r=new MediaRecorder(t);this.recorder=r,this.recorder.ondataavailable=function(t){return e.pushVideoData(t.data)},this.recorder.start()},pushVideoData:function(e){var t=this;return i(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(e.size>0)){r.next=8;break}return r.next=3,b.v4();case 3:n=r.sent,e.name="clip-"+n+".webm",t.recordings.push(e),"single"==t.recorderMode&&t.setView("videoPlayer"),t.$emit("new-recording",{name:e.name,size:e.size});case 8:case"end":return r.stop()}}),r)})))()},stopRecording:function(){var e=this;return i(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:null!==e.$refs.video&&e.$refs.video.srcObject&&e.recorder.stop();case 1:case"end":return t.stop()}}),t)})))()},pause:function(){null!==this.$refs.video&&this.$refs.video.srcObject&&this.$refs.video.pause()},resume:function(){null!==this.$refs.video&&this.$refs.video.srcObject&&this.$refs.video.play()},videoSnapshot:function(e){this.snapshot=this.getCanvas().toDataURL(this.screenshotFormat),this.snapshotSource=e,this.setView("snapshot")},getCanvas:function(){var e=this.$refs.video;if(!this.ctx){var t=document.createElement("canvas");t.height=e.videoHeight,t.width=e.videoWidth,this.canvas=t,this.ctx=t.getContext("2d")}var r=this.ctx,n=this.canvas;return r.drawImage(e,0,0,n.width,n.height),n},dataURItoBlob:function(e){return i(regeneratorRuntime.mark((function t(){var r,n,i,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(r=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],i=new Uint8Array(r.length),o=0;o<r.length;o++)i[o]=r.charCodeAt(o);return t.abrupt("return",new Blob([i],{type:n}));case 5:case"end":return t.stop()}}),t)})))()},closeSnapshot:function(){var e=this;return i(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.setView(e.snapshotSource),e.snapshot=null;case 2:case"end":return t.stop()}}),t)})))()},downloadSnapshot:function(){var e=this;return i(regeneratorRuntime.mark((function t(){var r,n,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.dataURItoBlob(e.snapshot);case 2:return r=t.sent,n=document.createElement("a"),document.body.appendChild(n),n.style="display: none",n.href=e.snapshot,t.next=9,b.v4();case 9:i=t.sent,n.download=i+r.type.split("/").pop(),n.click();case 12:case"end":return t.stop()}}),t)})))()},downloadRecording:function(e){var t=this;return i(regeneratorRuntime.mark((function r(){var n,i,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=t.recordings[e],i=URL.createObjectURL(n),o=document.createElement("a"),document.body.appendChild(o),o.style="display: none",o.href=i,o.download="video.webm",o.click(),window.URL.revokeObjectURL(i);case 9:case"end":return r.stop()}}),r)})))()},deleteRecording:function(e){"single"==this.recorderMode&&this.setView("video"),this.recordings.splice(e,1),this.$emit("delete-recording",e)},loadRecording:function(e){var t=this;return i(regeneratorRuntime.mark((function r(){var n,i;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=t.recordings[e],i=window.URL.createObjectURL(n),t.playerSource=i,t.nowPlaying=e,t.setView("videoPlayer"),t.$emit("player-loaded",!0);case 6:case"end":return r.stop()}}),r)})))()},playRecording:function(){this.$refs.videoPlayer.play()},pausePlayer:function(){null!==this.$refs.videoPlayer&&this.$refs.videoPlayer.pause()},resumePlayer:function(){null!==this.$refs.videoPlayer&&this.$refs.videoPlayer.play()},deletePlayerRecording:function(){this.setView("video"),this.deleteRecording(this.nowPlaying)},closePlayer:function(){this.setView("video")},muteRecorder:function(){this.$refs.video.mute()}}},undefined,false,undefined,!1,void 0,void 0,void 0),R=Object.freeze({__proto__:null,Multicorder:$}),O=function(e){Object.entries(R).forEach((function(t){var r=o(t,2),n=r[0],i=r[1];e.component(n,i)}))},V=Object.freeze({__proto__:null,default:O,Multicorder:$});return Object.entries(V).forEach((function(e){var t=o(e,2),r=t[0],n=t[1];"default"!==r&&(O[r]=n)})),O}(crypto);